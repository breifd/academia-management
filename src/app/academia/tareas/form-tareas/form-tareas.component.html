<div style="max-width: 800px; margin: 20px auto; background-color: #ffffff; border-radius: 10px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15); overflow: hidden; font-family: 'Segoe UI', Arial, sans-serif;">

  <!-- Cabecera del formulario -->
  <div style="background-color: #1e88e5; color: white; padding: 18px 24px; position: relative;">
    <h2 style="margin: 0; font-size: 22px; font-weight: 500;">{{ getModoTexto() }} Tarea</h2>
  </div>

  <!-- Cuerpo del formulario -->
  <div style="padding: 24px;">

    <!-- Mensajes de alerta -->
    <div *ngIf="error" style="background-color: #ffebee; color: #d32f2f; padding: 12px 16px; border-radius: 6px; margin-bottom: 20px; border-left: 4px solid #d32f2f; display: flex; align-items: center;">
      <span style="margin-right: 10px; font-size: 18px;">⚠️</span>
      <span>{{ error }}</span>
    </div>

    <div *ngIf="successMessage" style="background-color: #e8f5e9; color: #2e7d32; padding: 12px 16px; border-radius: 6px; margin-bottom: 20px; border-left: 4px solid #2e7d32; display: flex; align-items: center;">
      <span style="margin-right: 10px; font-size: 18px;">✅</span>
      <span>{{ successMessage }}</span>
    </div>

    <!-- Formulario -->
    <form [formGroup]="tareaForm" (ngSubmit)="guardar()">
      <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 20px;">

        <!-- Nombre -->
        <div style="margin-bottom: 16px;">
          <label for="nombre" style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">
            Nombre <span style="color: #e53935;">*</span>
          </label>
          <input
            type="text"
            id="nombre"
            formControlName="nombre"
            style="width: 100%; padding: 10px 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 16px; box-sizing: border-box;"
            [ngStyle]="{'border-color': tareaForm.get('nombre')?.invalid && tareaForm.get('nombre')?.touched ? '#e53935' : '#ddd'}">
          <div *ngIf="tareaForm.get('nombre')?.invalid && tareaForm.get('nombre')?.touched" style="color: #e53935; font-size: 13px; margin-top: 5px;">
            El nombre es obligatorio
          </div>
        </div>

        <!-- Fecha de Publicación -->
        <div style="margin-bottom: 16px;">
          <label for="fechaPublicacion" style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">
            Fecha de Publicación
          </label>
          <input
            type="date"
            id="fechaPublicacion"
            formControlName="fechaPublicacion"
            style="width: 100%; padding: 10px 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 16px; box-sizing: border-box;">
        </div>

        <!-- Fecha Límite -->
        <div style="margin-bottom: 16px;">
          <label for="fechaLimite" style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">
            Fecha Límite
          </label>
          <input
            type="date"
            id="fechaLimite"
            formControlName="fechaLimite"
            style="width: 100%; padding: 10px 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 16px; box-sizing: border-box;">
        </div>
        <div *ngIf="tareaForm.get('fechaLimite')?.errors?.['fechaInvalida']" style="color: #e53935; font-size: 13px; margin-top: 5px;">
          La fecha límite no puede ser anterior a la fecha de publicación
        </div>

        <!-- Nota -->
        <div style="margin-bottom: 16px;">
          <label for="nota" style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">
            Nota (0-10)
          </label>
          <input
            type="number"
            id="nota"
            formControlName="nota"
            min="0"
            max="10"
            step="0.1"
            style="width: 100%; padding: 10px 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 16px; box-sizing: border-box;"
            [ngStyle]="{'border-color': tareaForm.get('nota')?.invalid && tareaForm.get('nota')?.touched ? '#e53935' : '#ddd'}">
          <div *ngIf="tareaForm.get('nota')?.invalid && tareaForm.get('nota')?.touched" style="color: #e53935; font-size: 13px; margin-top: 5px;">
            La nota debe estar entre 0 y 10
          </div>
        </div>

        <!-- Documento (span 2 columnas) -->
        <div style="margin-bottom: 16px; grid-column: span 2;">
          <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">
            Documento
          </label>

          <!-- Muestra el nombre del documento actual si existe -->
          <div *ngIf="nombreArchivoActual" style="margin-bottom: 10px; display: flex; align-items: center;">
            <span class="badge badge-success" style="margin-right: 10px;">Documento cargado: {{ nombreArchivoActual }}</span>
            <button
              type="button"
              (click)="downloadFile()"
              style="background-color: #1976d2; color: white; border: none; border-radius: 4px; padding: 6px 12px; cursor: pointer;"
              *ngIf="mode !== 'crear'"
            >
              Descargar
            </button>
          </div>

          <!-- Selector de archivos (solo visible en edit o crear) -->
          <div *ngIf="mode === 'edit' || mode === 'crear'" style="display: flex; align-items: center;">
            <input
              type="file"
              id="documento"
              (change)="onFileSelected($event)"
              style="flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;"
            >

            <!-- Botón para subir archivo (solo visible después de seleccionar un archivo) -->
            <button
              *ngIf="archivoSeleccionado && tareaID"
              type="button"
              (click)="uploadFile()"
              style="margin-left: 10px; background-color: #4caf50; color: white; border: none; border-radius: 4px; padding: 6px 12px; cursor: pointer;"
            >
              Subir
            </button>
          </div>

          <!-- Mensaje informativo sobre el archivo seleccionado -->
          <div *ngIf="archivoSeleccionado" style="margin-top: 6px; font-size: 14px; color: #666;">
            Archivo seleccionado: {{ archivoSeleccionado.name }} ({{ (archivoSeleccionado.size / 1024).toFixed(2) }} KB)
          </div>

          <!-- Mensaje informativo en modo crear -->
          <div *ngIf="mode === 'crear' && !tareaID" style="margin-top: 6px; font-size: 14px; color: #666;">
            El documento se podrá subir después de guardar la tarea.
          </div>
        </div>

        <!-- Descripción (span 2 columnas) -->
        <div style="margin-bottom: 16px; grid-column: span 2;">
          <label for="descripcion" style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">
            Descripción
          </label>
          <textarea
            id="descripcion"
            formControlName="descripcion"
            rows="4"
            style="width: 100%; padding: 10px 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 16px; box-sizing: border-box; resize: vertical;"
            [ngStyle]="{'border-color': tareaForm.get('descripcion')?.invalid && tareaForm.get('descripcion')?.touched ? '#e53935' : '#ddd'}">
          </textarea>
          <div *ngIf="tareaForm.get('descripcion')?.invalid && tareaForm.get('descripcion')?.touched" style="color: #e53935; font-size: 13px; margin-top: 5px;">
            La descripción no puede exceder los 500 caracteres
          </div>
        </div>
      </div>

      <!-- Botones de acción -->
      <div style="display: flex; justify-content: flex-end; gap: 12px; margin-top: 24px; padding-top: 16px; border-top: 1px solid #eee;">
        <!-- Botón Cancelar -->
        <button
          type="button"
          (click)="cancelar()"
          style="padding: 10px 20px; background-color: #f5f5f5; color: #333; border: none; border-radius: 6px; font-weight: 500; cursor: pointer; min-width: 100px;">
          Cancelar
        </button>

        <!-- Botón Guardar - solo visible en modos editar o crear -->
        <button
          *ngIf="mode === 'edit' || mode === 'crear'"
          type="submit"
          [disabled]="tareaForm.invalid"
          style="padding: 10px 20px; background-color: #1e88e5; color: white; border: none; border-radius: 6px; font-weight: 500; cursor: pointer; min-width: 100px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);"
          [ngStyle]="{'opacity': tareaForm.invalid ? '0.7' : '1', 'cursor': tareaForm.invalid ? 'not-allowed' : 'pointer'}">
          Guardar
        </button>
      </div>
    </form>
  </div>
</div>
